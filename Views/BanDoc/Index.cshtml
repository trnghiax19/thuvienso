<!DOCTYPE html>
<html lang="vi">
<head>
	<meta charset="UTF-8">
	<title>Thông tin bạn đọc</title>
	<link rel="stylesheet" href="~/css/BanDoc.css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
</head>
<body>

	<div class="reader-container">
		<header class="page-header">
			<h2><i class="fa fa-users"></i> Quản lý bạn đọc</h2>
		</header>

		<ul class="nav nav-tabs ">
			<li class="active"><a data-toggle="tab" href="#readerInfo">Thông tin bạn đọc</a></li>
			<li><a data-toggle="tab" href="#statistics">Thống kê</a></li>
		</ul>
		<div class="tab-content">
			<!-- Tab 1: Thông tin bạn đọc -->
			<div id="readerInfo" class="tab-pane fade in active">
				<!-- Sub-tabs -->
				<ul class="nav nav-tabs" style="margin-bottom:15px;">
					<li class="active"><a data-toggle="tab" href="#profile">Quản lý bạn đọc</a></li>
					<li><a data-toggle="tab" href="#group">Quản lý nhóm đọc</a></li>
				</ul>
				<div class="tab-content">

					<!-- Quản lý bạn đọc -->
					<div id="profile" class="tab-pane fade in active">
						<div class="action-bar" style="margin-bottom:10px;">
							<div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
								<input type="text" class="form-control" id="searchInput" placeholder="🔍 Tìm kiếm bạn đọc...">
								<select class="form-control" id="filterGroup">
									<option value="">-- Lọc theo nhóm --</option>
									<option value="Sinh viên">Sinh viên</option>
									<option value="Giảng viên">Giảng viên</option>
								</select>
								<select class="form-control" id="filterStatus">
									<option value="">-- Lọc theo trạng thái --</option>
									<option value="Hoạt động">Hoạt động</option>
									<option value="Sắp hết hạn">Sắp hết hạn</option>
									<option value="Hết hạn">Hết hạn</option>
								</select>
								<button class="btn btn-custom btn-add-reader"><i class="fa fa-plus"></i> Thêm mới</button>
							</div>

							<div id="selectedActions" class="hidden" style="margin-top:10px; display:flex; align-items:center; flex-wrap:wrap; gap:10px;">
								<span id="selectedCount" class="text-primary" style="font-weight:600;"></span>
								<button class="btn btn-default btn-print-selected"><i class="fa fa-print"></i> In thẻ / Mã vạch</button>
								<button class="btn btn-danger btn-delete-selected"><i class="fa fa-trash"></i> Xoá đã chọn</button>
								<button class="btn btn-secondary btn-clear-selection"><i class="fa fa-times"></i> Bỏ chọn tất cả</button>
							</div>
						</div>

						<table class="table  table-hover" id="readerTable">
							<thead>
								<tr>
									<th><input type="checkbox" id="selectAll"></th>
									<th>STT</th>
									<th>Mã thẻ</th>
									<th>Thông tin bạn đọc</th>
									<th>Ngày cấp thẻ</th>
									<th>Ngày hết hạn</th>
									<th>Trạng thái</th>
									<th>Hành động</th>
								</tr>
							</thead>
							<tbody>
								<!-- Bảng sẽ được render từ JS -->
							</tbody>
						</table>

						<div class="table-footer">
							<div id="recordStats">Tổng 0 / 0 bản ghi</div>
							<ul class="pagination" id="pagination"></ul>
						</div>
					</div>

					<!-- Nhóm & Chính sách -->
					<div id="group" class="tab-pane fade">
						<div class="action-bar group-bar">
							<h4>
								<input type="text" class="form-control" id="searchGroupInput" placeholder="🔍 Tìm kiếm nhóm bạn đọc...">
								<button class="btn btn-info btn-sm" id="btnPolicyInfo" title="Chính sách nhóm chung"><i class="fa fa-info-circle"></i></button>
							</h4>
							<button class="btn btn-primary btn-add-group"><i class="fa fa-plus"></i> Thêm nhóm</button>
						</div>

						<table class="table table-hover" id="groupTable">
							<thead>
								<tr>
									<th>Tên nhóm</th>
									<th>Số sách tối đa</th>
									<th>Thời hạn mượn (ngày)</th>
									<th>Số lần gia hạn</th>
									<th>Phạt quá hạn (đ/ngày)</th>
									<th>Mượn tài liệu số</th>
									<th>Hành động</th>
								</tr>
							</thead>
							<tbody>
								<!-- Bảng sẽ được render từ JS -->
							</tbody>
						</table>
						<div class="table-footer">
							<div class="record-stats" id="groupStats"></div>
							<ul class="pagination" id="groupPagination"></ul>
						</div>
					</div>

					<!-- Modal hiển thị chính sách -->
					<div id="policyInfoModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog modal-lg">
							<div class="modal-content">
								<div class="modal-header bg-info text-white">
									<h4 class="modal-title"><i class="fa fa-info-circle"></i> Chính sách nhóm bạn đọc</h4>
								</div>
								<div class="modal-body">
									<p>Dưới đây là các quy định chung áp dụng cho mọi nhóm bạn đọc:</p>
									<ul>
										<li><strong>Số sách tối đa:</strong> Số lượng tài liệu được phép mượn cùng lúc.</li>
										<li><strong>Thời hạn mượn:</strong> Thời gian được giữ sách kể từ ngày mượn.</li>
										<li><strong>Số lần gia hạn:</strong> Số lần được phép gia hạn mượn nếu chưa có người đặt trước.</li>
										<li><strong>Phạt quá hạn:</strong> Mức phí áp dụng cho mỗi ngày trễ hạn trả sách.</li>
										<li><strong>Mượn tài liệu số:</strong> Quyền truy cập và tải xuống tài liệu điện tử.</li>
									</ul>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
								</div>
							</div>
						</div>
					</div>
					<!-- Modal thêm bạn đọc -->
					<div id="addReaderModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-primary text-white">
									<h4 class="modal-title"><i class="fa fa-plus-circle"></i> Thêm bạn đọc mới</h4>
								</div>
								<div class="modal-body">
									<form id="addReaderForm">
										<div class="form-group">
											<label>Họ tên</label>
											<input type="text" class="form-control" id="readerName" required>
										</div>
										<div class="form-group">
											<label>Email</label>
											<input type="email" class="form-control" id="readerEmail" required>
										</div>
										<div class="form-group">
											<label>Nhóm</label>
											<select class="form-control" id="readerGroup">
												<option value="Sinh viên">Sinh viên</option>
												<option value="Giảng viên">Giảng viên</option>
											</select>
										</div>
										<div class="form-group">
											<label>Trạng thái</label>
											<select class="form-control" id="readerStatus">
												<option value="Hoạt động">Hoạt động</option>
												<option value="Sắp hết hạn">Sắp hết hạn</option>
												<option value="Hết hạn">Hết hạn</option>
											</select>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
									<button type="button" class="btn btn-primary" id="btnSaveReader">Lưu</button>
								</div>
							</div>
						</div>
					</div>
					<!-- Modal sửa bạn đọc -->
					<div id="editReaderModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-info text-white">
									<h4 class="modal-title"><i class="fa fa-edit"></i> Sửa thông tin bạn đọc</h4>
								</div>
								<div class="modal-body">
									<form id="editReaderForm">
										<div class="form-group">
											<label>Họ tên</label>
											<input type="text" class="form-control" id="editReaderName" required>
										</div>
										<div class="form-group">
											<label>Email</label>
											<input type="email" class="form-control" id="editReaderEmail" required>
										</div>
										<div class="form-group">
											<label>Nhóm</label>
											<select class="form-control" id="editReaderGroup">
												<option value="Sinh viên">Sinh viên</option>
												<option value="Giảng viên">Giảng viên</option>
											</select>
										</div>
										<div class="form-group">
											<label>Trạng thái</label>
											<select class="form-control" id="editReaderStatus">
												<option value="Hoạt động">Hoạt động</option>
												<option value="Sắp hết hạn">Sắp hết hạn</option>
												<option value="Hết hạn">Hết hạn</option>
											</select>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
									<button type="button" class="btn btn-primary" id="btnUpdateReader">Cập nhật</button>
								</div>
							</div>
						</div>
					</div>
					<!-- Modal gia hạn thẻ -->
					<div id="extendCardModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-warning text-white">
									<h4 class="modal-title"><i class="fa fa-clock-rotate-left"></i> Gia hạn thẻ bạn đọc</h4>
								</div>
								<div class="modal-body">
									<form id="extendCardForm">
										<div class="form-group">
											<label>Ngày hết hạn hiện tại</label>
											<input type="text" class="form-control" id="currentExpireDate" readonly>
										</div>
										<div class="form-group">
											<label>Ngày hết hạn mới</label>
											<input type="date" class="form-control" id="newExpireDate" required>
										</div>

									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
									<button type="button" class="btn btn-warning" id="btnConfirmExtend">Lưu</button>
								</div>
							</div>
						</div>
					</div>
					<!-- Modal In Thẻ / Mã vạch -->
					<div id="printCardModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog modal-lg">
							<div class="modal-content">
								<div class="modal-header bg-primary text-white">
									<h4 class="modal-title"><i class="fa fa-id-card"></i> Xem & In thẻ bạn đọc</h4>
								</div>
								<div class="modal-body" id="printArea">
									<!-- Nội dung thẻ sẽ được render ở đây -->
								</div>
								<div class="modal-footer">
									<button class="btn btn-default" data-dismiss="modal">Đóng</button>
									<button class="btn btn-primary" id="btnPrint"><i class="fa fa-print"></i> In</button>
								</div>
							</div>
						</div>
					</div>
					<!-- Modal Thêm / Sửa nhóm bạn đọc -->
					<div id="groupModal" class="modal fade" tabindex="-1" role="dialog">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header bg-info text-white">
									<h4 class="modal-title"><i class="fa fa-layer-group"></i> <span id="groupModalTitle">Thêm nhóm</span></h4>
								</div>
								<div class="modal-body">
									<form id="groupForm">
										<div class="form-group">
											<label>Tên nhóm</label>
											<input type="text" class="form-control" id="groupName" required>
										</div>
										<div class="form-group">
											<label>Số sách tối đa</label>
											<input type="number" class="form-control" id="groupMaxBooks" min="1" required>
										</div>
										<div class="form-group">
											<label>Thời hạn mượn (ngày)</label>
											<input type="number" class="form-control" id="groupBorrowDays" min="1" required>
										</div>
										<div class="form-group">
											<label>Số lần gia hạn</label>
											<input type="text" class="form-control" id="groupExtendTimes" value="1">
										</div>
										<div class="form-group">
											<label>Phạt quá hạn (đ/ngày)</label>
											<input type="number" class="form-control" id="groupFine" min="0" value="0">
										</div>
										<div class="form-group">
											<label>Mượn tài liệu số</label>
											<select class="form-control" id="groupDigitalAccess">
												<option value="1">Có</option>
												<option value="0">Không</option>
											</select>
										</div>
									</form>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
									<button type="button" class="btn btn-primary" id="btnSaveGroup">Lưu</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- Tab 2: Thống kê -->
			<div id="statistics" class="tab-pane fade">

				<!-- Subtab nav -->
				<ul class="nav nav-tabs" id="statisticsSubtab" role="tablist" style="margin-bottom:20px;">
					<li class="active"><a href="#criteriaStats" data-toggle="tab">Theo tiêu chí</a></li>
					<li><a href="#overdueList" data-toggle="tab">Danh sách quá hạn </a></li>
					<li><a href="#circulationList" data-toggle="tab">Ấn phẩm lưu thông</a></li>
					<li><a href="#activeReaders" data-toggle="tab">Bạn đọc tích cực</a></li>
				</ul>

				<!-- Subtab content -->
				<div class="tab-content">
					<!-- Subtab 1: Theo tiêu chí -->
					<div class="tab-pane fade in active" id="criteriaStats">

						<!-- Filter nâng cao -->
						<div class="filter-bar" style="margin-bottom:20px; display:flex; align-items:center; gap:15px; flex-wrap:wrap;">
							<label for="genderSelect" style="font-weight:bold;">Giới tính:</label>
							<select id="genderSelect" class="form-control" style="width:120px;">
								<option value="all">Tất cả</option>
								<option value="male">Nam</option>
								<option value="female">Nữ</option>
							</select>

							<div style="display:flex; align-items:center; gap:5px;">
								<label for="ageInput" style="font-weight:bold;">Độ tuổi:</label>
								<input type="number" id="ageInput" name="age" min="6" max="80" value="18" style="width:60px; text-align:center;">
							</div>
						</div>

						<!-- Cards thống kê với progress bar -->
						<div class="cards-container" style="display:flex; gap:20px; flex-wrap:wrap;">
							<div class="stat-card" style="flex:1; min-width:150px; padding:20px; border-radius:10px; background-color:#4a90e2; color:#fff;">
								<h4>Học sinh</h4>
								<p>120 bạn đọc</p>
								<div style="background:#2980b9; height:8px; border-radius:4px;">
									<div style="width:28%; height:8px; background:#fff; border-radius:4px;"></div>
								</div>
								<small>28%</small>
							</div>
							<div class="stat-card" style="flex:1; min-width:150px; padding:20px; border-radius:10px; background-color:#2ecc71; color:#fff;">
								<h4>Sinh viên</h4>
								<p>200 bạn đọc</p>
								<div style="background:#27ae60; height:8px; border-radius:4px;">
									<div style="width:48%; height:8px; background:#fff; border-radius:4px;"></div>
								</div>
								<small>48%</small>
							</div>
							<div class="stat-card" style="flex:1; min-width:150px; padding:20px; border-radius:10px; background-color:#f39c12; color:#fff;">
								<h4>Giảng viên</h4>
								<p>80 bạn đọc</p>
								<div style="background:#d35400; height:8px; border-radius:4px;">
									<div style="width:19%; height:8px; background:#fff; border-radius:4px;"></div>
								</div>
								<small>19%</small>
							</div>
							<div class="stat-card" style="flex:1; min-width:150px; padding:20px; border-radius:10px; background-color:#9b59b6; color:#fff;">
								<h4>Khác</h4>
								<p>20 bạn đọc</p>
								<div style="background:#8e44ad; height:8px; border-radius:4px;">
									<div style="width:5%; height:8px; background:#fff; border-radius:4px;"></div>
								</div>
								<small>5%</small>
							</div>
						</div>

						<div class="chart-row" style="display:flex; gap:20px; margin-top:40px; flex-wrap:wrap;">
							<!-- Biểu đồ cột -->
							<div class="chart-container" style="flex:1; min-width:300px; padding:15px; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
								<h4>Số lượng bạn đọc theo nhóm</h4>
								<canvas id="barChart" style="height:300px;"></canvas>
							</div>

							<!-- Biểu đồ trend / timeline -->
							<div class="chart-container" style="flex:1; min-width:300px; padding:15px; background:#fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.1);">
								<h4>Xu hướng bạn đọc theo tháng</h4>
								<canvas id="lineChart" style="height:300px;"></canvas>
							</div>
						</div>

					</div>

					<!-- Subtab 2: Quá hạn & thông báo -->
					<div class="tab-pane fade" id="overdueList">

						<!-- Filter & tìm kiếm -->
						<div class="filter-bar" style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; align-items:center;">
							<input type="text" id="searchOverdue" class="form-control" placeholder="🔍 Tìm kiếm theo tên hoặc mã thẻ" style="width:250px;">
						</div>

						<!-- Table danh sách quá hạn -->
						<div class="table-responsive">
							<table class="table  table-hover">
								<thead>
									<tr>
										<th>STT</th>
										<th>Mã thẻ</th>
										<th>Tên bạn đọc</th>
										<th>Ngày mượn</th>
										<th>Ngày trả hạn</th>
										<th>Số ngày quá hạn</th>
										<th>Thông báo</th>
									</tr>
								</thead>
								<tbody>

									<!-- Dữ liệu sẽ được render động bằng JS -->
								</tbody>
							</table>
							<div class="table-footer">
								<div class="record-stats" id="overdueTable"></div>
								<ul class="pagination" id="overduePagination"></ul>
							</div>
						</div>
					</div>


					<!-- Subtab 3: Ấn phẩm lưu thông -->
					<div class="tab-pane fade" id="circulationList">

						<!-- Filter & tìm kiếm -->
						<div class="filter-bar" style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; align-items:center;">
							<input type="text" id="searchCirculation" class="form-control" placeholder="🔍 Tìm kiếm theo mã hoặc tên ấn phẩm" style="width:250px;">


						</div>

						<!-- Table danh sách ấn phẩm lưu thông -->
						<div class="table-responsive">
							<table class="table  table-hover">
								<thead>
									<tr>
										<th>STT</th>
										<th>Mã ấn phẩm</th>
										<th>Tên ấn phẩm</th>
										<th>Tác giả</th>
										<th>Loại</th>
										<th>Số lượng mượn</th>
										<th>Ngày mượn</th>
										<th>Ngày trả dự kiến</th>
									</tr>
								</thead>
								<tbody>

									<!-- Dữ liệu sẽ được render động bằng JS -->
								</tbody>
							</table>
							<div class="table-footer">
								<div class="record-stats" id="circulationTable"></div>
								<ul class="pagination" id="circulationPagination"></ul>
							</div>
						</div>
					</div>


					<!-- Subtab 4: Bạn đọc tích cực -->
					<div class="tab-pane fade" id="activeReaders">

						<!-- Filter & tìm kiếm -->
						<div class="filter-bar" style="display:flex; flex-wrap:wrap; gap:15px; margin-bottom:20px; align-items:center;">
							<label for="topN" style="font-weight:bold;">Top</label>
							<input type="number" id="topN" class="form-control" min="1" max="50" value="10" style="width:80px;">
							<label for="timeRange" style="font-weight:bold;">Khoảng thời gian:</label>
							<select id="timeRange" class="form-control" style="width:150px;">
								<option value="month">Tháng này</option>
								<option value="quarter">Quý này</option>
								<option value="year">Năm nay</option>
							</select>
							<button id="refreshActive" class="btn btn-primary" title="Cập nhật danh sách">
								<i class="fa-solid fa-rotate-right"></i>
							</button>

						</div>

						<!-- Table bạn đọc tích cực -->
						<div class="table-responsive">
							<table class="table  table-hover">
								<thead>
									<tr>
										<th>STT</th>
										<th>Mã thẻ</th>
										<th>Tên bạn đọc</th>
										<th>Số lượt mượn (vòng quay)</th>
										<th>Số sách đã mượn</th>
									</tr>
								</thead>
								<tbody>

									<!-- Dữ liệu render động bằng JS -->
								</tbody>
							</table>
							<div class="table-footer">
								<div class="record-stats" id="activeTable"></div>
								<ul class="pagination" id="activePagination"></ul>
							</div>
						</div>

						<!-- Biểu đồ số lượt mượn (vòng quay) -->
						<div class="chart-container" style="margin-top:30px;">
							<h4>Vòng quay bạn đọc (số lượt mượn)</h4>
							<canvas id="activeReadersChart"></canvas>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="~/js/BanDoc.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


</body>
</html>
