<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Notification Dashboard — Thông báo & Nhắc việc đa kênh (Demo)</title>

    <link rel="stylesheet" href="~/css/ThongBao.css" asp-append-version="true" />
</head>
<body>

    <div class="container-fluid">

        <!-- Header -->
        <div class="row">
            <div class="col-md-12">
                <header class="page-header">
                    <h2>
                    <i class="glyphicon glyphicon-bell text-primary"></i>
                        Thông báo & Nhắc việc đa kênh <small class="text-muted">— Quản lý, gửi, thống kê (Demo)</small>
                    </h2>
                </header>
            </div>
            <div class="col-md-8">
                <p class="header-sub">Hỗ trợ Email, SMS, Push, OTT, Webhook — phân quyền demo, cấu hình hệ thống, retry & throttle</p>
            </div>
            <div class="col-md-4 text-right pull-right-md">
                <div class="btn-group">
                    <button id="btn-open-create" class="btn btn-success"><i class="glyphicon glyphicon-plus"></i> Tạo thông báo</button>
                    <button id="btn-open-config" class="btn btn-default"><i class="glyphicon glyphicon-cog"></i> Thiết lập hệ thống</button>
                </div>
            </div>
        </div>

        <hr />

        <!-- Stats -->
        <div class="row">
            <div class="col-md-3 col-sm-6">
                <div class="small-card text-center">
                    <span class="glyphicon glyphicon-bell" style="font-size:24px; color:#007bff;"></span>
                    <div class="val" id="stat-total">0</div>
                    <div class="lbl">Tổng thông báo</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="small-card text-center">
                    <span class="glyphicon glyphicon-send" style="font-size:24px; color:#28a745;"></span>
                    <div class="val" id="stat-sent">0</div>
                    <div class="lbl">Đã gửi</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="small-card text-center">
                    <span class="glyphicon glyphicon-time" style="font-size:24px; color:#ffc107;"></span>
                    <div class="val" id="stat-pending">0</div>
                    <div class="lbl">Đang chờ</div>
                </div>
            </div>
            <div class="col-md-3 col-sm-6">
                <div class="small-card text-center">
                    <span class="glyphicon glyphicon-warning-sign" style="font-size:24px; color:#dc3545;"></span>
                    <div class="val" id="stat-error">0</div>
                    <div class="lbl">Lỗi</div>
                </div>
            </div>
        </div>

        <div class="row" style="margin-top:8px;">
            <div class="col-md-8">
                <div class="panel panel-default">
                    <div class="panel-heading"><strong><i class="glyphicon glyphicon-signal"></i> Thống kê gửi (7 ngày)</strong></div>
                    <div class="panel-body canvas-wrap">
                        <canvas id="chart-line" height="120"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="panel panel-info">
                    <div class="panel-heading"><strong><i class="glyphicon glyphicon-random"></i> Tỷ lệ kênh (tuần)</strong></div>
                    <div class="panel-body text-center canvas-wrap">
                        <canvas id="chart-doughnut" height="265"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters + table -->
        <div class="panel panel-default">
            <div class="panel-heading">
                <strong><i class="glyphicon glyphicon-list"></i> Danh sách thông báo</strong>
                <div class="pull-right">
                    <div class="form-inline">
                        <input id="filter-key" class="form-control input-sm" placeholder="Tìm tiêu đề..." style="width:220px;" />
                        <select id="filter-channel" class="form-control input-sm">
                            <option value="">Tất cả kênh</option>
                            <option>Email</option>
                            <option>SMS</option>
                            <option>Push</option>
                            <option>OTT</option>
                            <option>Webhook</option>
                        </select>
                        <select id="filter-status" class="form-control input-sm">
                            <option value="">Tất cả trạng thái</option>
                            <option>Đã gửi</option>
                            <option>Đang chờ</option>
                            <option>Lỗi</option>
                        </select>
                        <button id="btn-filter-reset" class="btn btn-default btn-sm">Đặt lại</button>
                    </div>
                </div>
            </div>

            <div class="panel-body">
                <div class="table-responsive">
                    <table id="notification-table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Tiêu đề</th>
                                <th>Kênh</th>
                                <th>Người tạo</th>
                                <th>Thời gian</th>
                                <th>Trạng thái</th>
                                <th class="text-center">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <nav class="text-center">
                    <ul id="pagination" class="pagination pagination-sm"></ul>
                </nav>
            </div>
        </div>
    </div>
  
    <!-- Toast area -->
    <div id="toast-area"></div>

    <!-- ---------- Modals ---------- -->
    <!-- Create / Edit modal -->
    <div id="modalCreateEdit" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <form id="formCreateEdit" class="modal-content">
                <div class="modal-header bg-primary text-white" style="padding:12px 15px;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 id="modalCreateTitle" class="modal-title">Tạo thông báo mới</h4>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" />
                    <div class="form-group">
                        <label>Tiêu đề</label>
                        <input name="title" class="form-control" required />
                    </div>
                    <div class="form-group">
                        <label>Thời gian gửi</label>
                        <input type="datetime-local" name="scheduleTime" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Chọn nhóm nhận</label>
                        <select name="targetGroups" class="form-control" multiple>
                            <!-- Lấy từ CONFIG.userGroups -->
                            <option value="Khoa CNTT">Khoa CNTT</option>
                            <option value="Lớp 10A">Lớp 10A</option>
                            <option value="Đơn vị Hành chính">Đơn vị Hành chính</option>
                        </select>
                        <small class="text-muted">Giữ Ctrl để chọn nhiều nhóm</small>
                    </div>

                    <div class="form-group">
                        <label>Nội dung</label>
                        <textarea name="message" rows="4" class="form-control" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Kênh</label>
                        <select name="channel" class="form-control">
                            <option>Email</option>
                            <option>SMS</option>
                            <option>Push</option>
                            <option>OTT</option>
                            <option>Webhook</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tùy chọn</label><br />
                        <label class="checkbox-inline"><input type="checkbox" name="simulateSend" /> Gửi thử (simulate)</label>
                        <label class="checkbox-inline"><input type="checkbox" name="important" /> Quan trọng</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Đóng</button>
                    <button type="submit" class="btn btn-success">Lưu & Gửi</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View details -->
    <div id="modalView" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header bg-info text-white" style="padding:12px 15px;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Chi tiết thông báo</h4>
                </div>
                <div class="modal-body">
                    <h4 id="view-title"></h4>
                    <p id="view-message" class="text-muted"></p>
                    <p><strong>Kênh:</strong> <span id="view-channel"></span></p>
                    <p><strong>Người tạo:</strong> <span id="view-user"></span></p>
                    <p><strong>Thời gian:</strong> <span id="view-time"></span></p>
                    <p><strong>Trạng thái:</strong> <span id="view-status"></span></p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirm delete -->
    <div id="modalDelete" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white" style="padding:12px 15px;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Xác nhận xóa</h4>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc muốn xóa thông báo này? Hành động không thể hoàn tác.</p>
                    <p id="delete-title" style="font-weight:700;"></p>
                </div>
                <div class="modal-footer">
                    <button id="btn-confirm-delete" class="btn btn-danger">Xóa</button>
                    <button class="btn btn-default" data-dismiss="modal">Hủy</button>
                </div>
            </div>
        </div>
    </div>

    <!-- System config modal -->
    <div id="modalConfig" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog">
            <form id="formConfig" class="modal-content">
                <div class="modal-header bg-primary text-white" style="padding:12px 15px;">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h4 class="modal-title">Cấu hình hệ thống</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Ngôn ngữ hệ thống</label>
                        <select name="systemLang" class="form-control">
                            <option value="vi">Tiếng Việt</option>
                            <option value="en">English</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Delay gửi (ms)</label>
                        <input type="number" name="sendDelay" class="form-control" value="800" />
                    </div>
                    <div class="form-group">
                        <label>Số lần thử khi thất bại</label>
                        <input type="number" name="retryCount" class="form-control" value="3" />
                    </div>
                    <div class="form-group">
                        <label>Chế độ Admin</label><br />
                        <div style="margin-top:8px;">
                            <label class="checkbox-inline"><input type="checkbox" id="chk-admin">(hiện nút Edit/Delete)</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-default" data-dismiss="modal">Đóng</button>
                    <button class="btn btn-success">Lưu cấu hình</button>
                </div>
            </form>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>

    @section Scripts {
        <script src="~/js/ThongBao.js"></script>
    }
</body>
</html>
